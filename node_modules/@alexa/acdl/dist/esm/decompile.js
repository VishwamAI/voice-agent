import fs from "fs-extra";
import { printModule } from "./print";
import { transformUIProject, isUISkill } from "./transformUIProject";
/**
 * Transforms source ASKIR JSON files into ACDL files.
 *
 * ACDL files are written directly alongside the original ASK JSON file.
 *
 * The original ASK JSON files are copied to the `build` directory configured in `package.json`.
 *
 * If ProjectVersion is UI, then:
 *
 * locale directories are flattened (for multi-locale only),
 *
 * file names and namespaces are updated (for multi-locale only),
 *
 * and skill action is created.
 *
 * @param project ACDL Project to decompile.
 * @param options optional options to customize the behavior of the decompile.
 */
export async function decompileProject(project) {
    if (await isUISkill(project)) {
        project = await transformUIProject(project);
    }
    const checker = project.getTypeChecker();
    const updatedFiles = await Promise.all(project.sourceModules.map(async (src) => {
        if (src.uri.endsWith(".json")) {
            const outFile = src.uri.replace(".json", ".acdl").replace(".ask.acdl", ".acdl");
            // write the new ACDL file
            await fs.writeFile(outFile, printModule(src.content, checker));
            await fs.unlink(src.uri);
            return src.uri;
        }
        return undefined;
    }));
    return updatedFiles.filter((f) => f !== undefined);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb21waWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2RlY29tcGlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDMUIsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUVwQyxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsU0FBUyxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFTbkU7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBQ0gsTUFBTSxDQUFDLEtBQUssVUFBVSxnQkFBZ0IsQ0FBQyxPQUFnQjtJQUNyRCxJQUFJLE1BQU0sU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQzVCLE9BQU8sR0FBRyxNQUFNLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzdDO0lBQ0QsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pDLE1BQU0sWUFBWSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FDcEMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3RDLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDN0IsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFaEYsMEJBQTBCO1lBQzFCLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUVoRSxNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXpCLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQztTQUNoQjtRQUNELE9BQU8sU0FBVSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUNILENBQUM7SUFFRixPQUFPLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQztBQUNyRCxDQUFDIn0=