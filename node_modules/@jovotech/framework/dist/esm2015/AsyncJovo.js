import { OutputTemplateConverter } from '@jovotech/output';
import { Jovo } from './Jovo';
export class AsyncJovo extends Jovo {
    async $send(outputConstructorOrTemplateOrMessage, options) {
        const currentOutputLength = this.$output.length;
        if (typeof outputConstructorOrTemplateOrMessage === 'function') {
            await super.$send(outputConstructorOrTemplateOrMessage, options);
        }
        else {
            await super.$send(outputConstructorOrTemplateOrMessage);
        }
        // get only the newly added output
        const newOutput = this.$output.slice(currentOutputLength);
        const outputConverter = new OutputTemplateConverter(this.$platform.outputTemplateConverterStrategy);
        let response = await outputConverter.toResponse(newOutput);
        response = await this.$platform.finalizeResponse(response, this);
        if (Array.isArray(response)) {
            for (const responseItem of response) {
                await this.sendResponse(responseItem);
            }
        }
        else if (response) {
            await this.sendResponse(response);
        }
    }
}
//# sourceMappingURL=AsyncJovo.js.map